# 백엔드 아키텍처

이 기획서는 **실시간 컴퓨팅 자원 모니터링 웹앱의 백엔드 시스템**에 대한 상세 기획서입니다.

---

## 1. 상세 작업 목록 (Tasks)

[✅] **`main.go`: 애플리케이션 진입점 설계**
  - [✅] 기본 HTTP 서버 설정
  - [✅] API 라우터 초기화 (`gorilla/mux` 또는 `chi` 사용)
  - [✅] `/api` 및 `/ws` 엔드포인트 핸들러 등록
  - [✅] 모니터링 서비스 고루틴 시작
  - [✅] 데이터베이스 연결 초기화

[❌] **`monitoring` 모듈: 자원 수집기 설계**
  - [✅] `gopsutil` 라이브러리 선정 및 의존성 추가
  - [✅] CPU 사용량 수집 함수 구현
  - [✅] 메모리 사용량 수집 함수 구현
  - [✅] 주기적(Ticker)으로 데이터 수집 및 채널(Channel) 전송 로직 구현

[❌] **`websockets` 모듈: 실시간 통신 허브 설계**
  - [✅] `Hub` 구조체 정의 (클라이언트 관리, 브로드캐스트 채널)
  - [✅] `Client` 구조체 정의 (WebSocket 연결, 데이터 채널)
  - [✅] 클라이언트 등록/해제 로직 구현
  - [✅] 데이터 브로드캐스트 로직 구현
  - [✅] WebSocket 메시지 포맷 정의 (JSON 형식: `{"type": "cpu", "data": ...}}`)

[✅] **`api` 모듈: HTTP API 핸들러 설계**
  - [✅] `/api/layouts` GET 핸들러 (대시보드 레이아웃 조회)
  - [✅] `/api/layouts` POST/PUT 핸들러 (대시보드 레이아웃 저장/수정)

[❌] **`db` 모듈: 데이터베이스 스키마 및 핸들러 설계**
  - [✅] `layouts` 테이블 스키마 정의 (`id`, `user_id`, `config_json`)
  - [✅] SQLite 초기화 및 테이블 자동 생성 로직
  - [✅] 레이아웃 조회 함수 구현
  - [✅] 레이아웃 저장/수정 함수 구현

---

## 2. 연관 기획서

- `[:Parent:]` `프로젝트_메인기획.md`

## 3. 백엔드 시스템 다이어그램

```mermaid
graph TD
    subgraph "Backend (Go)"
        A["main.go (애플리케이션 시작점)"] --> B{API 서버 (HTTP Router)}
        B -- "/ws<br/>(WebSocket 업그레이드)" --> C{WebSocket 핸들러}
        C -- "클라이언트 등록/해제" --> D[WebSocket 연결 관리자]
        C -- "메시지 처리" --> B

        B -- "/api/*" --> E{API 핸들러}
        E -- "대시보드 레이아웃 CRUD" --> F{데이터베이스 핸들러}
        F -- "데이터 I/O" --> G[("SQLite")]

        H[모니터링 서비스] -- "주기적 자원 수집" --> I{Windows 시스템 API<br/>(gopsutil/wmi)}
        H -- "수집된 데이터 전송" --> D
        D -- "모든 클라이언트에게 브로드캐스트" --> C
    end

    style A fill:#f9f,stroke:#333,stroke-width:2px
    style H fill:#cff,stroke:#333,stroke-width:2px
```

## 4. 모듈별 상세 설명

| 모듈 (패키지)  | 주요 책임                               | 설명                                                                                                |
| :------------- | :-------------------------------------- | :-------------------------------------------------------------------------------------------------- |
| `main.go`      | 애플리케이션 초기화 및 실행             | API 서버 실행, 모니터링 서비스 시작 등 전체 애플리케이션의 라이프사이클을 관리합니다.                 |
| `api`          | HTTP 요청 처리 및 라우팅                | `/api` 엔드포인트에 대한 요청을 받아 처리합니다. (예: 대시보드 레이아웃 저장)                          |
| `websockets`   | WebSocket 연결 관리 및 데이터 브로드캐스트 | 클라이언트와의 WebSocket 연결을 수립하고, 모니터링 모듈에서 받은 데이터를 모든 클라이언트에게 전송합니다. |
| `monitoring`